#
# Copyright (c) 2021 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-4-Clause
#

config FMNA
	bool "Enable FMN Accessory Development Kit"
	select BT
	select BT_PERIPHERAL
	select BT_SMP
	select BT_EXT_ADV
	select BT_TPS

	select BT_SETTINGS
	select FLASH
	select FLASH_MAP
	select NVS
	select SETTINGS

	select APP_EVENT_MANAGER

	select PM_SINGLE_IMAGE if !FMNA_UARP

if FMNA

config FMNA_CRYPTO
	bool
	default y
	select NRF_OBERON if FMNA_CRYPTO_ENTROPY_SRC && !NORDIC_SECURITY_BACKEND
	select OBERON_BACKEND if NORDIC_SECURITY_BACKEND
	select NORDIC_SECURITY_BACKEND if !FMNA_CRYPTO_ENTROPY_SRC

config FMNA_CRYPTO_ENTROPY_SRC
	bool
	default y if DT_HAS_NORDIC_NRF_RNG_ENABLED

config FMNA_QUALIFICATION
	bool "Enable qualification capabilities used by the FMCA app"

config FMNA_MAX_CONN
	int "Maximum number of FMN connections"
	default 2
	range 2 BT_MAX_CONN

config FMNA_TX_POWER
	int "TX power in dBm"
	help
	  TX power configuration in dBm used in advertising and connections.
	  Please note that the desired configuration may be different from the
	  actual one if a chosen HW platform does not support it. In this case,
	  the Find My stack displays a warning notifying the user about the
	  real TX power during the enabling procedure of this library. The
	  actual TX power value will be as close to the desired configuration
	  as possible.
	default 4
	range 4 8

config FMNA_CUSTOM_SERIAL_NUMBER
	bool "Use custom serial number from provisioned data"

config FMNA_SERVICE_HIDDEN_MODE
	bool "Hide the Find My services in the disabled state"
	select BT_GATT_SERVICE_CHANGED
	select BT_GATT_DYNAMIC_DB
	help
	  Have the FMN, AIS and Firmware Update services registered in the
	  Bluetooth GATT database only when the Find My stack is enabled.
	  In the disabled state, these services will not be visible to the
	  connected peers.

# Product Plan configuration
config FMNA_NORDIC_PRODUCT_PLAN
	bool "Use Nordic Product Plan"

# Pairing mode configuration
config FMNA_PAIRING_MODE_TIMEOUT
	int "Timeout for the pairing mode in seconds"
	default 600
	help
	  Override the default timeout for the pairing mode. Please note
	  that changes to this configuration are highly discouraged since
	  the specification requires a 10-minute timeout (or 600 seconds).
	  You can also use this configuration to implement the dynamic timeout.
	  In this case, it is best to set a value for this option that is
	  the greatest common divisor of all desired timeout values.
	  You should resume the advertising until you achieve your desired
	  timeout value.

config FMNA_PAIRING_MODE_AUTOSTART
	bool "Autostart the advertising in the pairing mode"
	default y
	help
	  Use the autostart feature to automatically start the Find My
	  advertising in the pairing mode when the FMN stack gets enabled or
	  the accessory becomes unpaired. With this configuration option
	  disabled, you need to call the fmna_resume API to enter the pairing
	  mode in the aforementioned scenarios.

# AIS configuration
menu "Accessory Information Service (AIS)"

config FMNA_MANUFACTURER_NAME
	string "FMN Accessory Manufacturer Name"
	default "Manufacturer"

config FMNA_MODEL_NAME
	string "FMN Accessory Model Name"
	default "Model"

config FMNA_CATEGORY
	int "FMN Accessory Category"
	range 1 167
	default 128

config FMNA_CAPABILITY_PLAY_SOUND_ENABLED
	bool "FMN Accessory Capability: declare sound playing capability"

config FMNA_CAPABILITY_DETECT_MOTION_ENABLED
	depends on FMNA_CAPABILITY_PLAY_SOUND_ENABLED
	bool "FMN Accessory Capability: declare motion detecting capability"

config FMNA_CAPABILITY_NFC_SN_LOOKUP_ENABLED
	bool "FMN Accessory Capability: declare Serial Number NFC lookup capability"

config FMNA_CAPABILITY_BLE_SN_LOOKUP_ENABLED
	bool "FMN Accessory Capability: declare Serial Number BLE lookup capability"

config FMNA_CAPABILITY_FW_UPDATE_ENABLED
	bool "FMN Accessory Capability: declare Firmware Update Service capability"

choice FMNA_BATTERY_TYPE
	prompt "FMN Accessory battery type"
	default FMNA_BATTERY_TYPE_POWERED

config FMNA_BATTERY_TYPE_POWERED
	bool "Powered"

config FMNA_BATTERY_TYPE_NON_RECHARGEABLE
	bool "Non-rechargeable battery"

config FMNA_BATTERY_TYPE_RECHARGEABLE
	bool "Rechargeable battery"

endchoice

endmenu

# Battery Level thresholds
config FMNA_BATTERY_STATE_CRITICAL_THR
	int "Battery level threshold [%] for entering critical battery state"
	range 0 100
	default 10

config FMNA_BATTERY_STATE_LOW_THR
	int "Battery level threshold [%] for entering low battery state"
	range 0 100
	default 40

config FMNA_BATTERY_STATE_MEDIUM_THR
	int "Battery level threshold [%] for entering medium battery state"
	range 0 100
	default 80

# NFC configuration
config FMNA_NFC
	bool
	depends on FMNA_CAPABILITY_NFC_SN_LOOKUP_ENABLED
	default y
	select NFC_T2T_NRFXLIB
	select NFC_NDEF
	select NFC_NDEF_MSG
	select NFC_NDEF_RECORD
	select NFC_NDEF_URI_REC
	select NFC_NDEF_URI_MSG
	help
	  Enable NFC support.

if !FMNA_UARP

menu "Firmware version"

config FMNA_FIRMWARE_VERSION_MAJOR
	int "FMNA Firmware major version"
	default 1
	range 0 65535

config FMNA_FIRMWARE_VERSION_MINOR
	int "FMNA Firmware major version"
	default 0
	range 0 255

config FMNA_FIRMWARE_VERSION_REVISION
	int "FMNA Firmware revision version"
	default 0
	range 0 255

endmenu
endif # !FMNA_UARP

# Override default BLE configuration

config BT_DEVICE_NAME
	default "Nordic_FMN"

config BT_L2CAP_TX_MTU
	default 247

config BT_BUF_ACL_RX_SIZE
	default 251

config BT_BUF_ACL_TX_SIZE
	default 251

config BT_CTLR_DATA_LENGTH_MAX
	default 251

config BT_CTLR_TX_PWR_DYNAMIC_CONTROL
	default y

config BT_ID_MAX
	default 2

config BT_MAX_CONN
	default 2

config BT_MAX_PAIRED
	default FMNA_MAX_CONN

config BT_GATT_SERVICE_CHANGED
	default n

config BT_PERIPHERAL_PREF_TIMEOUT
	default 100

config BT_CONN_PARAM_UPDATE_TIMEOUT
	default 500

# Override default Settings configuration

config SETTINGS_DYNAMIC_HANDLERS
	default n

rsource "uarp/Kconfig"

# Logger configuration

module = FMNA
module-str = FMNA
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"

endif # FMNA
